<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Spiiin's blog | Устройство спецэффектов на NES. Эффекты горизонтального скролла.</title><meta name="description" content=""><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=PT+Serif&amp;display=swap"><link rel="stylesheet" href="/css/highlights/darkula.css"><link rel="stylesheet" href="/css/main.css"><link rel="search" type="application/opensearchdescription+xml" href="http://spiiin.github.io/atom.xml" title="Spiiin's blog"><script>(function (i, s, o, g, r, a, m) {
  i['GoogleAnalyticsObject'] = r;
  i[r] = i[r] || function () {
    (i[r].q = i[r].q || []).push(arguments)
  }, i[r].l = 1 * new Date();
  a = s.createElement(o),
    m = s.getElementsByTagName(o)[0];
  a.async = 1;
  a.src = g;
  m.parentNode.insertBefore(a, m)
})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-00000000-0', 'auto');
ga('send', 'pageview');</script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Spiiin's blog" type="application/atom+xml">
</head><body><div class="container"><header class="main-header"><h1 class="main-header__title uplize"><a class="main-header__title__link" href="/"><img class="header-image" src="/images/favicon.png" width="36" height="36">Spiiin's blog</a></h1><nav class="main-header__nav"><ul class="main-nav"><li class="main-nav__list"><a class="main-nav__list__link" href="/" target="_self">HOME</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="/archives/" target="_self">ARCHIVE</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="/tags/meta" target="_self">TAGS</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="/blog/1" target="_self">ABOUT</a></li></ul></nav></header><main class="container__wrapper"><article class="article post"><h3 class="article__title">Устройство спецэффектов на NES. Эффекты горизонтального скролла.</h3><div class="article__date metadata"><div class="post-info">2018/02/22</div></div><div class="article__tags metadata">Tags:
<a class="article__tags__link metadata" href="/tags/nes/">nes</a><a class="article__tags__link metadata" href="/tags/hack/">hack</a><a class="article__tags__link metadata" href="/tags/lua/">lua</a></div><div class="article__body"><link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><p><code>TODO: восстановить гифки</code></p>
<p>В качестве примера для изучения спецэффектов на NES можно взять <a href="https://imgur.com/a/XJmb7" target="_blank" rel="noopener">эту коллекцию</a>.<br>Орудие для изучения - эмулятор <a href="https://spiiin.dreamwidth.org/115637.html" target="_blank" rel="noopener">Mesen</a> и скрипт <a href="https://github.com/spiiin/CadEditor/blob/master/Stuff/nes_lua/mesen_logParallax.lua" target="_blank" rel="noopener">mesen_logParallax.lua</a>.  </p>
<p>Он позволяет посмотреть, в каких играх используются эффекты горизонтального скролла, а в какие - что-то другое (анимации фона записью в видеопамять, смена видеобанков или что-либо ещё).  </p>
<p><a href="https://spiiin.dreamwidth.org/file/7131.png" target="_blank" rel="noopener"><img src="https://spiiin.dreamwidth.org/file/200x200/7131.png" alt="" title="battletoads_tunnel"></a>  </p>
<p>Под катом будет объяснение того, что такое эффекты горизонтального скролла, какие именно они бывают и много гифок с примерами. Вас предупреждали!  </p>
<p>Итак, самое простое и не очень понятное объяснение: эффекты горизонтального скролла - группа спецэффектов, которая получается за счёт того, что видеопроцессор NES умеет сдвигать позицию скролла в ходе рисования кадра. В начале кадра для видеопроцессора можно установить горизонтальную и вертикальное позицию левого верхнего угла заготовленной картинки, которую он будет отрисовывать. Далее он начинает рисовать кадр строку за строкой - вот <a href="https://www.youtube.com/watch?v=3BJU2drrtCM" target="_blank" rel="noopener">интересный пример</a> этого процесса, снятый в супер сломо.  </p>
<p>Прямо в ходе рисования можно подправить позицию горизонтального скролла (но не вертикального!), чтобы оставшаяся часть экрана сдвинулась горизонтально относительно предыдущей - это и есть эффект горизонтального скролла. С теорией всё, дальше примеры того, что именно можно получить таким способом.  </p>
<p><strong>Отрисовка GUI снизу или сверху экрана</strong>Простейший и понятнейший пример - <em>Super Mario Bros</em>.<br><a href="https://spiiin.dreamwidth.org/file/7890.gif" target="_blank" rel="noopener"><img src="https://spiiin.dreamwidth.org/file/200x200/7890.gif" alt=""></a><br>Здесь очевидно, что часть экрана над зелёной полосой не скроллится совсем, в отличие от нижней. Трюки, которые используются для того, чтобы точно попасть в период, пока видеопроцессор отрисовывает конкретную строку, очень хитрые, и заслуживают отдельной статьи. Отмечу только то, что если в игре для отображения GUI используется чёрная панель - скорее всего в период отрисовки чёрных строк игра вообще выключает рендеринг, чтобы сделать что-то сложное, что возможно только при выключенном рендеринге.  </p>
<p><strong>Параллакс</strong>Эффект параллакса позволяет отобразить то, что для наблюдателя находящиеся дальше объекты движутся медленнее, чем более близкие. В более новых играх специально для реализации этого существует возможность рисовать на нескольких слоях, независимых друг от друга, но на NES их нет, поэтому разработчики эмулировали слои за счёт горизонтального скроллинга частей картинки. Важное ограничение таких слоёв - чтобы они никогда не пересекались по вертикали между собой, что можно проверить в скрипте (без разделяющей слои линии они игроку намного менее заметно, что слои полностью раздельные).  </p>
<p>Простейший пример - бегущий на фоне заката кот-ниндзя из <em>Kyatto Ninden Teyandee.</em><br><a href="https://spiiin.dreamwidth.org/file/8574.gif" target="_blank" rel="noopener"><img src="https://spiiin.dreamwidth.org/file/200x200/8574.gif" alt=""></a>  </p>
<p>Здесь, также как и в Марио, достаточно всего одного разделения экрана на подвижную и неподвижную часть (ну и второе разделение зону GUI, которое встречается почти в каждой игре, про него отдельно упоминать не буду).  </p>
<p>Более красивый и сложный пример - красная планета в <em>Bucky O’Hare:</em><br><a href="https://spiiin.dreamwidth.org/file/9282.gif" target="_blank" rel="noopener"><img src="https://spiiin.dreamwidth.org/file/200x200/9282.gif" alt=""></a>  </p>
<p>Здесь к статичному небу добавлен слой дальних облаков в небе и более близких гор. Без разделительных линий кажется, что существует ещё слой ландшафта между горами и слоем игрока за счёт того, что он однородный и глаз не может определить движется ли этот слой или нет. Есть много игр с примерами параллакса такого типа - <em>Joe &amp; Mac - Caveman Ninja, Totally Rad, Metal Fighter, Vice - Project Doom</em> и другие.  </p>
<p>Однако стоит помнить, что если вы видите эффект пересечения слоёв на одной горизонтали (параллакс <a href="https://www.youtube.com/watch?v=dWHPNnrTmKs&amp;feature=youtu.be&amp;t=24m23s" target="_blank" rel="noopener">за окошками</a> в другом уровне <em>Bucky O’Hare</em>) или вообще вертикальный параллакс (на стенках колодца 2 уровня <em>Battletoads</em>, стартовая заставка <em>Megaman 2</em>), помните - горизонтальный скролл невозможно изменить посреди строки - в этих играх используются другие эффекты.  </p>
<p>Отдельный интересный случай параллакса с движущимся дальним фоном - уровни с поездами, примеров много, пусть будет <em>Spartan X2:</em><br><a href="https://spiiin.dreamwidth.org/file/9973.gif" target="_blank" rel="noopener"><img src="https://spiiin.dreamwidth.org/file/200x200/9973.gif" alt=""></a>  </p>
<p>Параллакс также заметен, если камера находится внутри овального объекта или пещеры. В таком случае нижняя и верхняя часть будут ближе к камере, чем дальняя стена. Лучший пример - турбо-туннель в <em>Battletoads:</em><br><a href="https://spiiin.dreamwidth.org/file/10357.gif" target="_blank" rel="noopener"><img src="https://spiiin.dreamwidth.org/file/200x200/10357.gif" alt=""></a><br>Последняя пара примеров, посвящённая параллаксу, относится к случаю, когда отображаемая плоскость сильно наклонена по отношению к камере, в этом случае будет хорошо заметна разная скорость движения частей плоскости, и необходимо много слоёв для её отображения.  </p>
<p>Посмотрите на количество слоёв пола в <em>TMNT4: Tournament Fighters</em>:<br><a href="https://spiiin.dreamwidth.org/file/10959.gif" target="_blank" rel="noopener"><img src="https://spiiin.dreamwidth.org/file/200x200/10959.gif" alt=""></a><br>Либо на море в <em>TMNT3: Manhatten Project:</em>  </p>
<p><a href="https://spiiin.dreamwidth.org/file/11460.gif" target="_blank" rel="noopener"><img src="https://spiiin.dreamwidth.org/file/200x200/11460.gif" alt=""></a>  </p>
<p><strong>Отображение движения частей сцены</strong>  </p>
<p>Данный эффект применяется как для отображения крупных частей сцены (босс в <em>Tiny Toon Adventures</em>, другие игры с движением только горизонтальных платформ):  </p>
<p><a href="https://spiiin.dreamwidth.org/file/11980.gif" target="_blank" rel="noopener"><img src="https://spiiin.dreamwidth.org/file/200x200/11980.gif" alt=""></a><br>Так и для относительно мелких частей сцены, вплоть до отдельных строк (участки дороги при повороте в <em>Super Spy Hunter</em>):<br><a href="https://spiiin.dreamwidth.org/file/12494.gif" target="_blank" rel="noopener"><img src="https://spiiin.dreamwidth.org/file/200x200/12494.gif" alt=""></a>  </p>
<p>Участком сцены также может быть крупный объект, который изначально выглядит спрайтом, а не фоном , но является слишком крупным для спрайта, потому что спрайты имеют ограничение на размер, общее количество, а также количество в одной строке. Например, шар у босса зелёной планеты в <em>Bucky O’ Hare</em> (эта игра вообще очень богата на разные эффекты) рисуется фоном, но двигается отдельно от пола:<br><a href="https://spiiin.dreamwidth.org/file/13217.gif" target="_blank" rel="noopener"><img src="https://spiiin.dreamwidth.org/file/200x200/13217.gif" alt=""></a><br>Тут отдельно хочется упомянуть игру <em>Chip &amp; Dale Rescue Rangers 2</em> и больших боссов в ней. Они рисуются в фоне, но параллакса в игре нет. Геймдизайнеры решили проблему раздельного движения боссов и пола гениально - перед движением босса всегда потухает свет и пола не видно. Особенно эффектно это сделано на боссе Ведьма:<br><a href="https://spiiin.dreamwidth.org/file/13793.gif" target="_blank" rel="noopener"><img src="https://spiiin.dreamwidth.org/file/200x200/13793.gif" alt=""></a>  </p>
<p>Часто эффекты раздельного движения слоёв сцены применяются для эффектного появления текста или заставок. Сразу два эффекта на старте <em>Jurassic Park</em>:<br><a href="https://spiiin.dreamwidth.org/file/14535.gif" target="_blank" rel="noopener"><img src="https://spiiin.dreamwidth.org/file/200x200/14535.gif" alt=""></a>  </p>
<p> или просто красивого совмещения частей сцены:<br> <a href="https://spiiin.dreamwidth.org/file/14865.gif" target="_blank" rel="noopener"><img src="https://spiiin.dreamwidth.org/file/200x200/14865.gif" alt=""></a><br> На этом у меня пока всё ^_^.</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></div></article><div class="pagination"><a class="pagination__link pagination__prev" href="/blog/7552/">Next</a><a class="pagination__link pagination__next" href="/blog/15290/">Back</a></div></main><footer class="footer metadata"><p class="footer__text">© 2022 spiiin</p><p class="footer__text">Powered by <a class="footer__text__link" href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a class="footer__text__link" href="https://pages.github.com/" target="_blank">Github Page</a></p></footer></div></body></html>