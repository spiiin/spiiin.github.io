<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Spiiin's blog | AI in imaginery world</title><meta name="description" content=""><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=PT+Serif&amp;display=swap"><link rel="stylesheet" href="/css/highlights/darkula.css"><link rel="stylesheet" href="/css/main.css"><link rel="search" type="application/opensearchdescription+xml" href="http://spiiin.github.io/atom.xml" title="Spiiin's blog"><script>(function (i, s, o, g, r, a, m) {
  i['GoogleAnalyticsObject'] = r;
  i[r] = i[r] || function () {
    (i[r].q = i[r].q || []).push(arguments)
  }, i[r].l = 1 * new Date();
  a = s.createElement(o),
    m = s.getElementsByTagName(o)[0];
  a.async = 1;
  a.src = g;
  m.parentNode.insertBefore(a, m)
})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-00000000-0', 'auto');
ga('send', 'pageview');</script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Spiiin's blog" type="application/atom+xml">
</head><body><div class="container"><header class="main-header"><h1 class="main-header__title uplize"><a class="main-header__title__link" href="/"><img class="header-image" src="/images/favicon.png" width="36" height="36">Spiiin's blog</a></h1><nav class="main-header__nav"><ul class="main-nav"><li class="main-nav__list"><a class="main-nav__list__link" href="/" target="_self">HOME</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="/archives/" target="_self">ARCHIVE</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="/tags/meta" target="_self">TAGS</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="/blog/1" target="_self">ABOUT</a></li></ul></nav></header><main class="container__wrapper"><div class="pagination"><a class="pagination__link pagination__prev" href="/blog/3525050862/">Позже</a><a class="pagination__link pagination__next" href="/blog/1596814086/">Раньше</a></div><article class="article post"><h3 class="article__title">AI in imaginery world</h3><div class="article__date metadata"><div class="post-info">2023/04/09</div></div><div class="article__tags metadata">Tags:
<a class="article__tags__link metadata" href="/tags/python/">python</a><a class="article__tags__link metadata" href="/tags/ai/">ai</a></div><div class="article__body"><link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><p>Попробовал решить <a href="/blog/1160489034/" title="задачу Джеймса Бонда-младшего">задачу Джеймса Бонда-младшего</a> с помощью <code>openai</code>.</p>
<p>Из интереса, где-то с 30 запросов (притом на русском языке) к 3-й версии ChatGPT получилось объяснить условие задачи. Часть запросов “отладочные”, чтобы понять, то, что пытается делать ИИ с моделью.</p>
<p>Примеры:<br><em>“Попробуй выполнить операции - сдвиг вправо 2-й строки, сдвиг вправо 3-й строки, сдвиг вправо 4-й строки. Примени каждую из них к начальной позиции”</em><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Конечно, вот результаты применения операций к начальной позиции квадрата чисел:</span><br><span class="line"></span><br><span class="line">Сдвиг вправо 2-й строки на одну позицию:</span><br><span class="line"></span><br><span class="line">Copy code</span><br><span class="line">11 12 13 14</span><br><span class="line">24 21 22 23</span><br><span class="line">31 32 33 34</span><br><span class="line">41 42 43 44</span><br><span class="line">Сдвиг вправо 3-й строки на одну позицию:</span><br><span class="line"></span><br><span class="line">Copy code</span><br><span class="line">11 12 13 14</span><br><span class="line">21 22 23 24</span><br><span class="line">34 31 32 33</span><br><span class="line">41 42 43 44</span><br><span class="line">Сдвиг вправо 4-й строки на одну позицию:</span><br><span class="line"></span><br><span class="line">Copy code</span><br><span class="line">11 12 13 14</span><br><span class="line">21 22 23 24</span><br><span class="line">31 32 33 34</span><br><span class="line">44 41 42 43</span><br><span class="line">В каждом случае соответствующая строка сдвинулась на одну позицию вправо, и последний элемент строки перешел на первое место.</span><br></pre></td></tr></table></figure></p>
<p><em>“Теперь попробуй выполнить операцию «сдвиг 4го столбца вверх» по шагам”</em></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Конечно! Вот пошаговое описание:</span><br><span class="line"></span><br><span class="line">Выделяем 4-й столбец:</span><br><span class="line">(11 12 13 14) (21 22 23 24) (31 32 33 34) (41 42 43 44)</span><br><span class="line"></span><br><span class="line">14 24 34 44</span><br><span class="line"></span><br><span class="line">Сдвигаем 4-й столбец вверх:</span><br><span class="line">(11 12 13 14) (21 22 23 24) (31 32 33 34) (41 42 43 44)</span><br><span class="line"></span><br><span class="line">14 24 34 44</span><br><span class="line">11 21 31 41</span><br><span class="line"></span><br><span class="line">Вставляем 4-й столбец обратно на своё место:</span><br><span class="line">(11 12 13 14) (21 22 23 24) (31 32 33 34) (41 42 43 44)</span><br><span class="line"></span><br><span class="line">12 13 14 44</span><br><span class="line">22 23 24 21</span><br><span class="line">32 33 34 31</span><br><span class="line">42 43 11 41</span><br><span class="line"></span><br><span class="line">Таким образом, получаем следующую конечную позицию.</span><br></pre></td></tr></table></figure>
<p><em>Во втором шаге ошибка — столбец 14 24 34 44 при сдвиге вверх станет 24 34 44 14</em><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Извините за ошибку в предыдущем ответе. Правильно будет так:</span><br><span class="line"></span><br><span class="line">Выделяем четвертый столбец: (14, 24, 34, 44)</span><br><span class="line">Сдвигаем его вверх: (24, 34, 44, 14)</span><br><span class="line">Вставляем сдвинутый столбец обратно в исходный квадрат:</span><br><span class="line">(11, 12, 13, 24)</span><br><span class="line"></span><br><span class="line">(21, 22, 23, 34)</span><br><span class="line"></span><br><span class="line">(31, 32, 33, 44)</span><br><span class="line"></span><br><span class="line">(41, 42, 43, 14)</span><br></pre></td></tr></table></figure></p>
<p>Ощущения — как от объяснения не очень умному школьнику, 4-я версия наверное быстрее уловит смысл. Но с момента, когда просишь переписать решение на Python, “школьник” безошибочно пишет функцию применения всех операций к исходной позиции, и поиск в ширину.</p>
<p>Дальше — интересней, ИИ может дописать оптимизацию с сортировкой с помощью функции оценки — предлагает эвклидово расстояние, а также манхеттенское расстояние и расстояние чебышева. C расстоянием эвклида он доходит до хорошей скорости выполнения. ИИ использовал для хранения списка открытых вершин <a href="https://docs.python.org/3/library/queue.html#queue.PriorityQueue" target="_blank" rel="noopener">PriorityQueue</a>. Это даёт отличающийся от моей самой первой программы (которая использует для хранения list и сортирует его каждые N шагов) результат — находит путь в 10 шагов, а не 9.</p>
<p>ИИ предложил добавить в код замену функции оценки с эвклидова расстояния на манхеттенское (при этому утверждает, что для “пятнашек”, за которые он принял эту задачу, эта функция гарантированно даёт лучшую оценку, хотя я не стал бы ему доверять в таких утверждениях). С <code>jupyter notebook</code> обращение к ИИ за переписыванием кода может выглядеть примерно так:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">//cell1, тут недописанный код</span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_astar_path</span><span class="params">(start, end, operations)</span>:</span></span><br><span class="line">    queue = PriorityQueue()</span><br><span class="line">    queue.put((<span class="number">0</span>, [start]))</span><br><span class="line">    visited = set()</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> queue.empty():</span><br><span class="line">        _, path = queue.get()</span><br><span class="line">        vertex = path[<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">if</span> vertex == end:</span><br><span class="line">            print(<span class="string">"hash "</span>, len(visited), <span class="string">" queue "</span>, queue.qsize())</span><br><span class="line">            <span class="keyword">return</span> path</span><br><span class="line">        <span class="keyword">if</span> tuple(vertex) <span class="keyword">not</span> <span class="keyword">in</span> visited:</span><br><span class="line">            <span class="keyword">for</span> operation <span class="keyword">in</span> operations:</span><br><span class="line">                possible_path = path + [operation(vertex)]</span><br><span class="line">                queue.put((len(path) + euclide_distance(possible_path[<span class="number">-1</span>], target), possible_path))</span><br><span class="line">            visited.add(tuple(vertex))</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">//cell2</span><br><span class="line">ss = <span class="string">"Rewrite function find_astar_path for using manhattan distance instead of euclide distance:\n"</span></span><br><span class="line">ss += _i1 <span class="comment">#обращение к тексту cell1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os, openai</span><br><span class="line"></span><br><span class="line">openai.api_key = os.getenv(<span class="string">"OPENAI_API_KEY"</span>)</span><br><span class="line"></span><br><span class="line">response = openai.Completion.create(</span><br><span class="line">  model=<span class="string">"text-davinci-003"</span>,</span><br><span class="line">  prompt=ss,</span><br><span class="line">  temperature=<span class="number">0.7</span>,</span><br><span class="line">  max_tokens=<span class="number">256</span>,</span><br><span class="line">  top_p=<span class="number">1</span>,</span><br><span class="line">  frequency_penalty=<span class="number">0</span>,</span><br><span class="line">  presence_penalty=<span class="number">0</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>Это позволило ИИ дойти до решения в 9 шагов, однако увеличило время выполнения с 2 до 10 секунд. Дальнейшие предложенные ChatGPT методы оптимизации — распараллеливание работы, построение предпросчитанной базы решений и переход на С++.</p>
<p>Ни одним из них он не справился сам. Мне не удалось заставить его реализовать свою наивную идею, или предложить её — <em>“если мы знаем, что функции оценки не очень хорошие, то вместо использования очереди приоритетов на каждом шаге, проверим заодно еще группу решений с немного худшей оценкой и посмотрим, не нашлось ли там решения лучше”</em>. Скорее всего, я просто не знаю “правильного” названия этого метода, поэтому пришлось дописать эту логику самому.</p>
<p>Интересно, что при этом я случайно обнаружил, что существует решение не в 9, а 8 шагов:<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">source = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>]</span><br><span class="line">target = [<span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">path:</span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span> ,<span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>] source</span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>] Right(<span class="number">2</span>)</span><br><span class="line">    [<span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>] Left(<span class="number">0</span>)</span><br><span class="line">    [<span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">1</span>] Down(<span class="number">3</span>)</span><br><span class="line">    [<span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>] Up(<span class="number">1</span>)</span><br><span class="line">    [<span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>] Left(<span class="number">0</span>)</span><br><span class="line">    [<span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>] Left(<span class="number">2</span>)</span><br><span class="line">    [<span class="number">4</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>] Down(<span class="number">2</span>)</span><br><span class="line">    [<span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>] Up(<span class="number">1</span>) == target</span><br></pre></td></tr></table></figure></p>
<p><strong>Когда есть возможность быстро попробовать много вариантов, среди них больше шансов обнаружить лучший</strong></p>
<p>Код: <a href="https://github.com/spiiin/james_bond_jr_problem/blob/main/james_bond_jr_openai.ipynb" target="_blank" rel="noopener">https://github.com/spiiin/james_bond_jr_problem/blob/main/james_bond_jr_openai.ipynb</a></p>

<div id="gitalk-container"></div>
<script src="https://cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

		<script>
		var gitalkConfig = {"clientID":"Ov23liG1mZbiQOIdi91X","clientSecret":"e05812685eb741a752982b89dcf6f5b58dc10251","repo":"spiiin.github.io","owner":"spiiin","admin":["spiiin"],"distractionFreeMode":false};
	    gitalkConfig.id = md5(location.pathname);
		var gitalk = new Gitalk(gitalkConfig);
	    gitalk.render("gitalk-container");
	    </script><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></div></article><div class="pagination"><a class="pagination__link pagination__prev" href="/blog/3525050862/">Позже</a><a class="pagination__link pagination__next" href="/blog/1596814086/">Раньше</a></div></main><footer class="footer metadata"><p class="footer__text">© 2024 spiiin</p><p class="footer__text">Powered by <a class="footer__text__link" href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a class="footer__text__link" href="https://pages.github.com/" target="_blank">Github Page</a></p></footer></div></body></html>