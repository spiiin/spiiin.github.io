<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Spiiin's blog | Устройство уровней NES-игр с блоками 16 тайлов + 1 байт палитры.</title><meta name="description" content=""><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=PT+Serif&amp;display=swap"><link rel="stylesheet" href="/css/highlights/darkula.css"><link rel="stylesheet" href="/css/main.css"><link rel="search" type="application/opensearchdescription+xml" href="http://spiiin.github.io/atom.xml" title="Spiiin's blog"><script>(function (i, s, o, g, r, a, m) {
  i['GoogleAnalyticsObject'] = r;
  i[r] = i[r] || function () {
    (i[r].q = i[r].q || []).push(arguments)
  }, i[r].l = 1 * new Date();
  a = s.createElement(o),
    m = s.getElementsByTagName(o)[0];
  a.async = 1;
  a.src = g;
  m.parentNode.insertBefore(a, m)
})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-00000000-0', 'auto');
ga('send', 'pageview');</script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Spiiin's blog" type="application/atom+xml">
</head><body><div class="container"><header class="main-header"><h1 class="main-header__title uplize"><a class="main-header__title__link" href="/"><img class="header-image" src="/images/favicon.png" width="36" height="36">Spiiin's blog</a></h1><nav class="main-header__nav"><ul class="main-nav"><li class="main-nav__list"><a class="main-nav__list__link" href="/" target="_self">HOME</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="/archives/" target="_self">ARCHIVE</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="/tags/meta" target="_self">TAGS</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="/blog/1" target="_self">ABOUT</a></li></ul></nav></header><main class="container__wrapper"><div class="pagination"><a class="pagination__link pagination__prev" href="/blog/10556/">Позже</a><a class="pagination__link pagination__next" href="/blog/2987839410/">Раньше</a></div><article class="article post"><h3 class="article__title">Устройство уровней NES-игр с блоками 16 тайлов + 1 байт палитры.</h3><div class="article__date metadata"><div class="post-info">2017/01/10</div></div><div class="article__tags metadata">Tags:
<a class="article__tags__link metadata" href="/tags/nes/">nes</a><a class="article__tags__link metadata" href="/tags/hack/">hack</a></div><div class="article__body"><link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><p>После праздников взял в руки <a href="http://spiiin.livejournal.com/99765.html" target="_blank" rel="noopener">NesBlockFinder</a>, и прошёлся им по играм, добавленным в CadEditor с помощью <a href="http://spiiin.livejournal.com/73202.html" target="_blank" rel="noopener">Autocorrupter</a>‘а. Схема простая – меняем в редакторе в тестовом РОМе один из блоков на первом экране на 0-й (по нему проще находить начало списка блоков), и запускаем поиск блоков в BlockFinder’е. С помощью применения такого подхода обнаружилась целая группа игр, в основе описания уровней которых содержится одна и та же структура: <img src="http://ic.pics.livejournal.com/spiiin/20318251/50681/50681_300.png" alt=""> Она состоит из 16 байт, которые построчно кодируют номера 16-тайлов видеопамяти, по ним строится блок размером 4x4 тайла (именно блок, а не макроблок, как в играх капком). В дополнение к индексам тайлов с таким блоком связан 1 байт, в котором закодированы индексы палитры для каждой группы 2x2 блока (выделены на скриншоте разными цветами), по 2 бита на каждую группу из 4х блоков слева-направо сверху-вниз. Биты палитры применяются сразу к группе тайлов из-за аппаратных особенностей NES, именно так на ней хранится описание бекграунда. NesBlockFinder не ищет такие биты палитры, но во всех проверенных случаях это описание оказывалось либо сразу за массивом описания блока тайлами, либо сразу перед ним, так что обнаружить поинтер на эти биты очень просто. Кроме того, каждому тайлу видеопамяти присвоена физическая характеристика (проходимость, стена, передний фон, шипы и т.п.), чаще всего она закодирована в самом номере блока. Эта структура оказалась настолько универсальной, что она обнаружилась в следующих играх: <strong>Power Blade 1-2</strong> (разработчик Natsume) <strong>Adventure Island 2-3</strong> (Hudson soft) <strong>Yo-Noid</strong> (Now production) <strong>Jackie Chan Action Kung Fu</strong> (Now production) <strong>Contra Force</strong> (Konami) <strong>Batman Returns</strong> (Konami) <strong>Super C</strong> (Konami) <strong>Monster in My Pocket</strong> (Konami) <strong>Bucky O’Hare</strong> (Konami) <strong>Jackal</strong> (Konami) <strong>Teenage Mutant Ninja Turtles 1-3</strong> (Konami) <strong>Alien 3</strong> (Probe entertaiment) <strong>Battletoads</strong> (Rare) <strong>Battletoads &amp; Double Dragon</strong> (Rare) <strong>Darkman</strong> (Ocean software) <a href="http://ic.pics.livejournal.com/spiiin/20318251/50866/50866_original.png" target="_blank" rel="noopener"><img src="http://ic.pics.livejournal.com/spiiin/20318251/50866/50866_300.png" alt=""></a> И, возможно, обнаружится ещё в паре десятков других игр для этой платформы. Такая универсальность объясняется тем, что её легко закодировать (легче, чем иерархическую систему из блоков и макроблоков).</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></div></article><div class="pagination"><a class="pagination__link pagination__prev" href="/blog/10556/">Позже</a><a class="pagination__link pagination__next" href="/blog/2987839410/">Раньше</a></div></main><footer class="footer metadata"><p class="footer__text">© 2023 spiiin</p><p class="footer__text">Powered by <a class="footer__text__link" href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a class="footer__text__link" href="https://pages.github.com/" target="_blank">Github Page</a></p></footer></div></body></html>