<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Spiiin's blog | Python in imaginary world</title><meta name="description" content=""><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=PT+Serif&amp;display=swap"><link rel="stylesheet" href="/css/highlights/darkula.css"><link rel="stylesheet" href="/css/main.css"><link rel="search" type="application/opensearchdescription+xml" href="http://spiiin.github.io/atom.xml" title="Spiiin's blog"><script>(function (i, s, o, g, r, a, m) {
  i['GoogleAnalyticsObject'] = r;
  i[r] = i[r] || function () {
    (i[r].q = i[r].q || []).push(arguments)
  }, i[r].l = 1 * new Date();
  a = s.createElement(o),
    m = s.getElementsByTagName(o)[0];
  a.async = 1;
  a.src = g;
  m.parentNode.insertBefore(a, m)
})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-00000000-0', 'auto');
ga('send', 'pageview');</script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Spiiin's blog" type="application/atom+xml">
</head><body><div class="container"><header class="main-header"><h1 class="main-header__title uplize"><a class="main-header__title__link" href="/"><img class="header-image" src="/images/favicon.png" width="36" height="36">Spiiin's blog</a></h1><nav class="main-header__nav"><ul class="main-nav"><li class="main-nav__list"><a class="main-nav__list__link" href="/" target="_self">HOME</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="/archives/" target="_self">ARCHIVE</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="/tags/meta" target="_self">TAGS</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="/blog/1" target="_self">ABOUT</a></li></ul></nav></header><main class="container__wrapper"><article class="article post"><h3 class="article__title">Python in imaginary world</h3><div class="article__date metadata"><div class="post-info">2009/06/01</div></div><div class="article__tags metadata">Tags:
<a class="article__tags__link metadata" href="/tags/nes/">nes</a><a class="article__tags__link metadata" href="/tags/python/">python</a><a class="article__tags__link metadata" href="/tags/hack/">hack</a></div><div class="article__body"><link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-tag-hint@0.3.1/dist/hexo-tag-hint.min.css"><p>Запись из архива. </p>
<p>Играл в <code>James Bond Jr.</code> на NES :<br><img src="/blog/28461/jb0.jpg" alt="1"></p>
<p>В этой игрушке в первой зоне сын известного спецагента Джеймса Бонда должен деактивировать 5 ракет главзлодея. Чтобы “выключить” ракету, необходимо решить головоломку - заданы исходное поле из разноцветных клеток и целевая позиция, в которую надо перевести поле, сдвигая любую строку или столбец. </p>
<p>В принципе, задача решается не очень сложно, но мне захотелось поупражняться в программировании, и поэтому, под катом, скрипт - помощник суперагента :)</p>
<p><a href="http://www.everfall.com/paste/id.php?wvfuemnvkvin" target="_blank" rel="noopener">Код</a></p>
<p>В коде использован  <a href="http://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D0%B8%D1%81%D0%BA_%D0%B2_%D1%88%D0%B8%D1%80%D0%B8%D0%BD%D1%83" target="_blank" rel="noopener">алгоритм поиска в ширину</a>.</p>
<p>Работает так : </p>
<ul>
<li>Задача представляется в виде графа, в котором вершины - состояния поля, а ребра - допустимые переходы от одного состояния к другому (в коде допустимые фукнции переходов хранятся в массиве <strong>fun</strong> ) .</li>
<li>Имеются 2 списка -  <strong>open</strong> , в котором хранятся вершины, которые предстоит просмотреть и  <strong>closed</strong> , в котором хранятся уже просмотренные вершины.</li>
<li>Помимо собственно вершины в элементах списков <strong>open</strong> и <strong>closed</strong> также хранится вершина, из которой был совершен переход в данное состояние. Это делается для того, чтобы по окончании поиска можно было восстановить последовательность переходов (функция  <strong>extract</strong> ).</li>
<li>Изначально в  <strong>open</strong>  кладется стартовое состояние поля. Далее циклически совершается раскрытие вершины. Оно заключается в добавлении к списку открытых вершин всех вершин, в которые можно перейти из данной и перемещении раскрываемой вершины в список  <strong>closed</strong> . Раскрытые вершины добавляются в конец списка  <strong>open</strong> , что обеспечивает обход графа в ширину. Цикл завершается, если текущая раскрываемая вершина является целевой или если заканчиваются раскрываемые вершины (это означает, что перейти в конечное состояние из стартового невозможно).</li>
<li>Когда целевая вершина найдена, необходимо пройтись по списку <strong>closed</strong> и восстановить путь от цели к исходной вершине, пользуясь указателями, которые были добавлены при раскрытии. Я для удобства сделал не только извлечение пути из списка, но и вывод ответа в форме “какую линию и в какую сторону двигать”. Для еще большего удобства можно сделать перевод в набор кнопок, которые нужно нажимать на геймпаде для получения результата :)</li>
</ul>
<p>Описание алгоритма  <a href="http://www.intuit.ru/department/algorithms/gaa/4/" target="_blank" rel="noopener">здесь</a>  и  <a href="http://pmg.org.ru/ai/stout.htm" target="_blank" rel="noopener">здесь</a> .</p>
<p>Первую версию функции поиска делал извращенно-рекурсивной, с передачей open- и closed- списков, как параметров, но быстро офигел от количества потребляемой памяти и переписал код с использованием итераций.</p>
<p>Вторая версия тормозила про проверке, входит ли элемент в списки open или close, пришлось еще дополнительно сделать хэш-таблицу  <strong>open-hash</strong>  для быстрой проверки вхождения. </p>
<p><strong>upd</strong>  Пока тестировал решение для 4-го варианта, после 500000 просмотренных вершин понял, что слепой поиск не рулит, и сделал примитивную оценочную функцию  <strong>rate</strong> , которая примерно показывает, сколько еще шагов осталось до конца работы (считается разница между текущей позицией и целевой), и раз в 500 вершин проводит сортировку списка входных вершин по данной оценке.</p>
<p>Таким образом, время решения значительно улучшается, и Джеймс Бонд должен успеет обезвредить вражеские ракеты за отведенные ему 45 минут =) Ну и да, скрипт теперь реализует не поиск в ширину, а какой-то из частных случаев <a href="http://ru.wikipedia.org/wiki/%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_%D0%BF%D0%BE%D0%B8%D1%81%D0%BA%D0%B0_A*" target="_blank" rel="noopener">А-алгоритма</a>, у которого эвристическая функция состоит только из прогноза оставшегося пути и не учитывает пройденного расстояния, но это в данной ситуации неважно, главное, быстрее получить ответ.</p>
<hr>
<p>И, собственно, решения:<br><img src="/blog/28461/jb1.jpg" alt="1"></p>
<p>====== 1 ======<br>source:[1, 2, 3, 4, 4, 1, 2, 3, 3, 4, 1, 2, 2, 3, 4, 1]<br>target:[1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4]<br>[‘left’ , 1] #означает - сдвиг 1-й строки влево. отсчет строк и столбцов ведется с нуля<br>[‘left’ , 2]<br>[‘left’ , 2]<br>[‘right’ , 3]<br><img src="/blog/28461/jb2.jpg" alt="1"><br>====== 2 ======<br>source:[1,1,1,1, 1,2,3,1, 1,3,2,1, 1,1,1,1]<br>target:[1,1,1,1, 1,3,3,1, 1,2,2,1, 1,1,1,1]<br>[‘left’ , 1]<br>[‘up’ , 1]<br>[‘right’, 1]<br>[‘down’ , 1]<br><img src="/blog/28461/jb3.jpg" alt="1"><br>====== 3 ======<br>source:[1,2,1,3, 3,2,1,2, 1,1,3,1, 1,2,1,3]<br>target:[3,1,2,3, 2,1,1,1, 1,1,1,2, 3,2,1,3]<br>[‘right’, 0]<br>[‘right’, 2]<br>[‘down’ , 3]<br>[‘up’ , 0]<br>[‘left’ , 1]<br><img src="/blog/28461/jb4.jpg" alt="1"><br>====== 4 ======<br>source:[1,2,2,1, 3,4,4,3, 3,4,4,3, 2,4,4,2]<br>target:[4,3,4,2, 3,1,2,4, 4,2,4,3, 2,4,3,1]<br>only difs:<br>[‘left’ , 2]<br>[‘up’ , 3]<br>[‘right’, 1]<br>[‘down’ , 2]<br>[‘right’, 0]<br>[‘down’ , 1]<br>[‘right’, 0]<br>[‘left’ , 2]<br>[‘left’ , 2]<br><img src="/blog/28461/jb5.jpg" alt="1"><br>====== 5 ======<br>source:[1,1,2,2, 1,1,2,2, 3,3,4,4, 3,3,4,4]<br>target:[1,1,2,2, 1,3,4,2, 3,3,4,4, 1,3,4,2]<br>[‘left’, 1]<br>[‘up’ , 0]<br>[‘left’, 1]<br>[‘left’, 1]<br>[‘up’ , 3]<br>[‘left’, 1]<br><img src="/blog/28461/jb6.jpg" alt="1"></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script></div></article><section class="comments"><div id="disqus_thread"></div><script>var disqus_shortname = 'spiiin-github-io';
(function () {
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async></script></section><div class="pagination"><a class="pagination__link pagination__prev" href="/blog/45994/">Next</a><a class="pagination__link pagination__next" href="/blog/1/">Back</a></div></main><footer class="footer metadata"><p class="footer__text">© 2022 spiiin</p><p class="footer__text">Powered by <a class="footer__text__link" href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a class="footer__text__link" href="https://pages.github.com/" target="_blank">Github Page</a></p></footer></div></body></html>