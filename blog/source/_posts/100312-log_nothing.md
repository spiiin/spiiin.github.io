---
title: Логи ниочем - 2
tags:
  - iphone
  - objc
abbrlink: 64916
date: 2010-03-12 01:59:00
---

Писать на Objective C пришлось намного быстрее, чем хотелось :)

Сегодня занимался налаживанием отношений между [OpenKODE](http://www.khronos.org/openkode/) и [Crystal SDK](http://www.crystalsdk.com/). В мануале по интеграции `Crystal` очень доступно, с иллюстрациями описывается, как добавить библиотеку в стандартный XCode проект. Только после проведения описанных действий не работает часть кнопок и залогиниться невозможно.

Наводку на решение нашел тут -<http://permalink.gmane.org/gmane.comp.lib.sdl/46505>. 
Там на первый взгляд другая проблема - интеграция [OpenFeint](http://www.openfeint.com/) и [SDL](http://www.libsdl.org/), а решение такое же.

Надо сделать в главном цикле приложения OpenKODE (скорее всего в kdMain) дополнительную проверку, активно ли окно Crystal и если нужно, вызвать дополнительную обработку сообщений, чтобы дать возможность библиотеке отреагировать на тапы по экрану.  
Как-то так:

```cpp
void kdAdditionalUpdate()
{   
    if( achivLib->IsActive() )
    {
        CFRunLoopRunInMode(kCFRunLoopDefaultMode, 1, TRUE);
    };
}
```
  
А для отрисовки сообщений внутри игры надо еще сказать `Crystal`'у, что в приложении используется `OpenGL` (точнее ему надо сказать, что [Cocos](http://cocos2d.org/), он поймет). Как это сделать, сказано тут - <http://devsupport.crystalsdk.com/default.asp?W24> (доступно только при регистрации).  
  
Тогда взлетит.  
  
*upd* Взлетит, но упадет. Чтобы полет шел без осложнений, надо еще установать свойство `CrystalSession activateCrystalSetting в @"YES"`, чтобы Crystal не пытался поворачивать свой интерфейс при повороте устройства, потому что иначе приложение может упасть, если начать танцевать с айфоном (см. <http://spiiin.livejournal.com/14190.html>).